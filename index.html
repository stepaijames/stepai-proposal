<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STEP AI ì •ë¶€ì§€ì›ì‚¬ì—… í˜„í™©</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif; background: #f8f9fa; color: #333; line-height: 1.6; }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    header { background: #fff; border-bottom: 1px solid #e9ecef; padding: 20px 0; margin-bottom: 24px; }
    header h1 { font-size: 1.5rem; font-weight: 700; color: #212529; }
    header p { font-size: 0.875rem; color: #868e96; margin-top: 4px; }
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .kpi-card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
    .kpi-card .label { font-size: 0.813rem; color: #868e96; margin-bottom: 8px; }
    .kpi-card .value { font-size: 1.75rem; font-weight: 700; color: #212529; }
    .kpi-card .value.danger { color: #e03131; }
    .kpi-card .value.success { color: #2b8a3e; }
    .kpi-card .value.warning { color: #e67700; }
    .kpi-card .sub { font-size: 0.7rem; color: #adb5bd; margin-top: 4px; }
    .filters { background: #fff; border-radius: 12px; padding: 16px 20px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
    .filter-row { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
    .filter-group { display: flex; flex-direction: column; gap: 4px; }
    .filter-group label { font-size: 0.7rem; color: #868e96; font-weight: 500; }
    .filter-group select, .filter-group input { padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 0.813rem; min-width: 140px; background: #fff; }
    .status-pills { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
    .status-pill { padding: 6px 14px; border-radius: 16px; font-size: 0.813rem; font-weight: 500; cursor: pointer; transition: all 0.15s; border: 2px solid transparent; }
    .status-pill.active { border-color: #212529; }
    .status-pill[data-status="ì „ì²´"] { background: #f1f3f5; color: #495057; }
    .status-pill[data-status="ê²€í† ì¤‘"] { background: #fff3bf; color: #e67700; }
    .status-pill[data-status="ì‘ì„±ì¤‘"] { background: #d3f9d8; color: #2b8a3e; }
    .status-pill[data-status="ì œì¶œì™„ë£Œ"] { background: #d0ebff; color: #1971c2; }
    .status-pill[data-status="ì‹¬ì‚¬ì¤‘"] { background: #e5dbff; color: #7048e8; }
    .status-pill[data-status="ì„ ì •"] { background: #c3fae8; color: #099268; }
    .status-pill[data-status="íƒˆë½"] { background: #ffc9c9; color: #c92a2a; }
    .status-pill[data-status="ë“œë"] { background: #e03131; color: #fff; }
    .projects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 16px; }
    .project-card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); transition: all 0.2s; position: relative; border-left: 4px solid transparent; }
    .project-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .project-card[data-status="ê²€í† ì¤‘"] { border-left-color: #e67700; }
    .project-card[data-status="ì‘ì„±ì¤‘"] { border-left-color: #2b8a3e; }
    .project-card[data-status="ì œì¶œì™„ë£Œ"] { border-left-color: #1971c2; }
    .project-card[data-status="ì‹¬ì‚¬ì¤‘"] { border-left-color: #7048e8; }
    .project-card[data-status="ì„ ì •"] { border-left-color: #099268; background: #f0fff4; }
    .project-card[data-status="íƒˆë½"] { border-left-color: #c92a2a; opacity: 0.7; }
    .project-card[data-status="ë“œë"] { border-left-color: #e03131; background: #fff5f5; opacity: 0.6; }
    .project-card .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; gap: 12px; }
    .project-card .title { font-size: 0.95rem; font-weight: 600; color: #212529; flex: 1; }
    .project-card .status-select { padding: 4px 8px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 0.75rem; font-weight: 600; cursor: pointer; background: #fff; }
    .project-card .status-select[data-status="ê²€í† ì¤‘"] { background: #fff3bf; color: #e67700; border-color: #e67700; }
    .project-card .status-select[data-status="ì‘ì„±ì¤‘"] { background: #d3f9d8; color: #2b8a3e; border-color: #2b8a3e; }
    .project-card .status-select[data-status="ì œì¶œì™„ë£Œ"] { background: #d0ebff; color: #1971c2; border-color: #1971c2; }
    .project-card .status-select[data-status="ì‹¬ì‚¬ì¤‘"] { background: #e5dbff; color: #7048e8; border-color: #7048e8; }
    .project-card .status-select[data-status="ì„ ì •"] { background: #c3fae8; color: #099268; border-color: #099268; }
    .project-card .status-select[data-status="íƒˆë½"] { background: #ffc9c9; color: #c92a2a; border-color: #c92a2a; }
    .project-card .status-select[data-status="ë“œë"] { background: #e03131; color: #fff; border-color: #e03131; }
    .project-card .meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.75rem; color: #868e96; margin-bottom: 12px; }
    .project-card .deadline { color: #495057; }
    .project-card .deadline.urgent { color: #e03131; font-weight: 600; }
    .progress-bar { height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden; margin-top: 12px; }
    .progress-bar .fill { height: 100%; background: linear-gradient(90deg, #4dabf7, #228be6); border-radius: 3px; transition: width 0.3s; }
    .project-card[data-status="ì„ ì •"] .progress-bar .fill { background: linear-gradient(90deg, #69db7c, #2b8a3e); }
    .project-card[data-status="ë“œë"] .progress-bar .fill { background: #e03131; }
    .progress-text { font-size: 0.7rem; color: #868e96; margin-top: 4px; text-align: right; }
    .project-card .note { margin-top: 10px; padding: 6px 10px; background: #fff9db; border-radius: 4px; font-size: 0.7rem; color: #e67700; }
    .project-card .link-btn { display: inline-block; margin-top: 10px; padding: 6px 12px; background: #e7f5ff; color: #1971c2; border-radius: 4px; font-size: 0.75rem; font-weight: 500; text-decoration: none; }
    .project-card .link-btn:hover { background: #d0ebff; }
    .empty-state { text-align: center; padding: 48px 20px; color: #868e96; grid-column: 1/-1; }
    footer { text-align: center; padding: 32px 20px; color: #adb5bd; font-size: 0.75rem; }
    .reset-btn { padding: 6px 12px; background: #f1f3f5; border: 1px solid #dee2e6; border-radius: 6px; font-size: 0.75rem; color: #495057; cursor: pointer; margin-left: auto; }
    .reset-btn:hover { background: #e9ecef; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>STEP AI ì •ë¶€ì§€ì›ì‚¬ì—… í˜„í™©</h1>
      <p>SSOT ê¸°ë°˜ ì‹¤ì‹œê°„ ë™ê¸°í™” ëŒ€ì‹œë³´ë“œ Â· ìƒíƒœ ë³€ê²½ ì¦‰ì‹œ ë°˜ì˜</p>
    </div>
  </header>
  <main class="container">
    <div class="kpi-grid" id="kpi-grid"></div>
    <div class="filters">
      <div class="filter-row">
        <div class="filter-group">
          <label>ì¹´í…Œê³ ë¦¬</label>
          <select id="filter-category"></select>
        </div>
        <div class="filter-group">
          <label>ê²€ìƒ‰</label>
          <input type="text" id="filter-search" placeholder="ì‚¬ì—…ëª… ê²€ìƒ‰...">
        </div>
        <button class="reset-btn" onclick="resetData()">ì´ˆê¸°í™”</button>
      </div>
    </div>
    <div class="status-pills" id="status-pills"></div>
    <div class="projects-grid" id="projects-grid"></div>
  </main>
  <footer>
    <p>STEP AI Inc. Â· Last updated: <span id="last-updated"></span></p>
  </footer>

  <script>
    // ===================== SSOT: ë‹¨ì¼ ë°ì´í„° ì†ŒìŠ¤ =====================
    const DEFAULT_PROJECTS = [
      { id: 1, title: "2026 ì´ˆê¸°ì°½ì—…íŒ¨í‚¤ì§€ (ì¼ë°˜í˜•)", agency: "ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€ / ì°½ì—…ì§„í¥ì›", category: "ì°½ì—…ì§€ì›", status: "ê²€í† ì¤‘", progress: 20, deadline: "2026-02-13", budget: "ìµœëŒ€ 1ì–µ", link: "https://www.k-startup.go.kr", note: "ìê²©ìš”ê±´ ë¦¬ìŠ¤í¬: ëŒ€í‘œì ê¸°ì¡´ ë²•ì¸ ë³´ìœ  ì´ë ¥" },
      { id: 2, title: "2026 ë°©ì†¡ì˜ìƒì½˜í…ì¸  ì œì‘ì§€ì› (ë‹¤í)", agency: "KOCCA", category: "ì½˜í…ì¸ ", status: "ê²€í† ì¤‘", progress: 10, deadline: "2026-03-04", budget: "ìµœëŒ€ 1.5ì–µ", link: "https://www.kocca.kr", note: "í•„ìˆ˜: ë°©ì†¡ì˜ìƒë…ë¦½ì œì‘ì‚¬ì‹ ê³ í•„ì¦" },
      { id: 3, title: "ë””ì§€í„¸ë¯¸ë””ì–´ì´ë…¸ë² ì´ì…˜ R&D", agency: "ë°©í†µìœ„ / IITP", category: "R&D", status: "ì‘ì„±ì¤‘", progress: 60, deadline: "2026-02-12", budget: "32ì–µ (ì»¨ì†Œì‹œì—„)", link: "https://www.iris.go.kr" },
      { id: 4, title: "K-Culture ëŒ€ì¤‘ì†Œ ê³µë™ë„ì•½", agency: "KOCCA", category: "ì½˜í…ì¸ ", status: "ì‘ì„±ì¤‘", progress: 45, deadline: "2026-02-25", budget: "77ì–µ (3ë…„)", link: "https://www.kocca.kr", note: "â­ KT ENA í˜‘ì˜ ì¤‘" },
      { id: 5, title: "KOCCA ê¸°ì—…ì°½ì‘ì „ë‹´ë¶€ì„œ ì¸ì¦", agency: "KOCCA", category: "ì¸ì¦", status: "ì‹¬ì‚¬ì¤‘", progress: 80, deadline: "2026-02-27", budget: "-", link: "https://www.kocca.kr" },
      { id: 6, title: "ë²¤ì²˜ê¸°ì—… ì¸ì¦", agency: "ë²¤ì²˜ê¸°ì—…í˜‘íšŒ", category: "ì¸ì¦", status: "ì‹¬ì‚¬ì¤‘", progress: 70, deadline: "2026-02-11", budget: "-", link: "https://www.venturein.or.kr", note: "2/11 ìµœì¢…ì‹¬ì˜ ì˜ˆì •" },
      { id: 7, title: "ë°©ì†¡ì˜ìƒë…ë¦½ì œì‘ì‚¬ ì‹ ê³ ", agency: "ê³¼ê¸°ì •í†µë¶€", category: "ì¸ì¦", status: "ì„ ì •", progress: 100, deadline: "2026-01-15", budget: "-", link: "https://www.kcc.go.kr", note: "âœ… ì‹ ê³ ë²ˆí˜¸ ì œ12351í˜¸" },
      { id: 8, title: "í•œêµ­ì €ì‘ê¶Œìœ„ì›íšŒ ë“±ë¡", agency: "ì €ì‘ê¶Œìœ„ì›íšŒ", category: "ì¸ì¦", status: "ê²€í† ì¤‘", progress: 50, deadline: "2026-03-01", budget: "-", link: "https://www.cros.or.kr", note: "ë³´ì™„ì‚¬í•­ í•´ê²° ì¤‘" }
    ];

    const STATUSES = ["ì „ì²´", "ê²€í† ì¤‘", "ì‘ì„±ì¤‘", "ì œì¶œì™„ë£Œ", "ì‹¬ì‚¬ì¤‘", "ì„ ì •", "íƒˆë½", "ë“œë"];
    const STATUS_OPTIONS = STATUSES.filter(s => s !== "ì „ì²´");

    // ===================== STATE =====================
    let projects = loadProjects();
    let state = { selectedStatus: "ì „ì²´", selectedCategory: "ì „ì²´", searchQuery: "" };

    function loadProjects() {
      const saved = localStorage.getItem("stepai_projects");
      return saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(DEFAULT_PROJECTS));
    }

    function saveProjects() {
      localStorage.setItem("stepai_projects", JSON.stringify(projects));
    }

    function resetData() {
      if (confirm("ëª¨ë“  ìƒíƒœë¥¼ ì´ˆê¸°ê°’ìœ¼ë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        localStorage.removeItem("stepai_projects");
        projects = JSON.parse(JSON.stringify(DEFAULT_PROJECTS));
        render();
      }
    }

    // ===================== DERIVED CALCULATIONS =====================
    function getFilteredProjects() {
      return projects.filter(p => {
        const matchStatus = state.selectedStatus === "ì „ì²´" || p.status === state.selectedStatus;
        const matchCategory = state.selectedCategory === "ì „ì²´" || p.category === state.selectedCategory;
        const matchSearch = p.title.toLowerCase().includes(state.searchQuery.toLowerCase());
        return matchStatus && matchCategory && matchSearch;
      });
    }

    function getStatusCounts() {
      const counts = { "ì „ì²´": projects.length };
      projects.forEach(p => { counts[p.status] = (counts[p.status] || 0) + 1; });
      return counts;
    }

    function getCategories() {
      return ["ì „ì²´", ...new Set(projects.map(p => p.category))];
    }

    function getKPIs(filtered) {
      const total = filtered.length;
      const active = filtered.filter(p => !["ì„ ì •", "íƒˆë½", "ë“œë"].includes(p.status));
      const avgProgress = active.length > 0 ? Math.round(active.reduce((s, p) => s + p.progress, 0) / active.length) : 0;
      const today = new Date();
      const in14 = new Date(today); in14.setDate(today.getDate() + 14);
      const urgent = filtered.filter(p => {
        if (["ì„ ì •", "íƒˆë½", "ë“œë"].includes(p.status)) return false;
        const d = new Date(p.deadline);
        return d >= today && d <= in14;
      }).length;
      const completed = filtered.filter(p => p.status === "ì„ ì •").length;
      const dropped = filtered.filter(p => p.status === "ë“œë" || p.status === "íƒˆë½").length;
      return { total, avgProgress, urgent, completed, dropped };
    }

    function getDaysUntil(dateStr) {
      const today = new Date(); today.setHours(0,0,0,0);
      return Math.ceil((new Date(dateStr) - today) / 86400000);
    }

    // ===================== STATUS CHANGE =====================
 function changeStatus(id, newStatus) {
      const project = projects.find(p => p.id === id);
      if (project) {
        const oldStatus = project.status;
        project.status = newStatus;
        
        if (newStatus === "ì„ ì •") {
          project.progress = 100;
        } else if (newStatus === "ë“œë") {
          project.progress = 0;
        } else if (newStatus === "íƒˆë½") {
          if (oldStatus === "ì œì¶œì™„ë£Œ") {
            project.progress = 70;
          } else if (oldStatus === "ì‹¬ì‚¬ì¤‘") {
            project.progress = 85;
          } else {
            project.progress = 85;
          }
        }
        
        saveProjects();
        render();
      }
    }

    // ===================== RENDER =====================
    function render() {
      const filtered = getFilteredProjects();
      const kpis = getKPIs(filtered);
      const statusCounts = getStatusCounts();
      const categories = getCategories();

      // KPI Cards
      document.getElementById("kpi-grid").innerHTML = `
        <div class="kpi-card"><div class="label">ì „ì²´ ì‚¬ì—…</div><div class="value">${kpis.total}</div><div class="sub">í•„í„° ì ìš© ê¸°ì¤€</div></div>
        <div class="kpi-card"><div class="label">í‰ê·  ì§„í–‰ë¥ </div><div class="value">${kpis.avgProgress}%</div><div class="sub">ì§„í–‰ ì¤‘ ì‚¬ì—…</div></div>
        <div class="kpi-card"><div class="label">ë§ˆê° ì„ë°•</div><div class="value ${kpis.urgent > 0 ? 'danger' : ''}">${kpis.urgent}</div><div class="sub">14ì¼ ì´ë‚´</div></div>
        <div class="kpi-card"><div class="label">ì„ ì •</div><div class="value success">${kpis.completed}</div><div class="sub">ì™„ë£Œ</div></div>
        <div class="kpi-card"><div class="label">ë“œë/íƒˆë½</div><div class="value ${kpis.dropped > 0 ? 'warning' : ''}">${kpis.dropped}</div><div class="sub">ë¯¸ì§„í–‰</div></div>
      `;

      // Category Filter
      const catSelect = document.getElementById("filter-category");
      catSelect.innerHTML = categories.map(c => `<option value="${c}" ${c === state.selectedCategory ? 'selected' : ''}>${c}</option>`).join("");

      // Status Pills
      document.getElementById("status-pills").innerHTML = STATUSES.map(s => {
        const count = statusCounts[s] || 0;
        if (s !== "ì „ì²´" && count === 0) return "";
        return `<div class="status-pill ${state.selectedStatus === s ? 'active' : ''}" data-status="${s}" onclick="setStatus('${s}')">${s} (${count})</div>`;
      }).join("");

      // Project Cards
      const grid = document.getElementById("projects-grid");
      if (filtered.length === 0) {
        grid.innerHTML = `<div class="empty-state">ğŸ“‹ ì¡°ê±´ì— ë§ëŠ” ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>`;
      } else {
        grid.innerHTML = filtered.map(p => {
          const days = getDaysUntil(p.deadline);
          const isUrgent = days >= 0 && days <= 14 && !["ì„ ì •", "íƒˆë½", "ë“œë"].includes(p.status);
          const deadlineText = days < 0 ? "ë§ˆê°" : days === 0 ? "D-Day" : `D-${days}`;
          const statusOptions = STATUS_OPTIONS.map(s => `<option value="${s}" ${p.status === s ? 'selected' : ''}>${s}</option>`).join("");
          return `
            <div class="project-card" data-status="${p.status}">
              <div class="header">
                <div class="title">${p.title}</div>
                <select class="status-select" data-status="${p.status}" onchange="changeStatus(${p.id}, this.value)">${statusOptions}</select>
              </div>
              <div class="meta">
                <span>ğŸ“Œ ${p.agency}</span>
                <span>ğŸ’° ${p.budget}</span>
              </div>
              <div class="meta">
                <span class="deadline ${isUrgent ? 'urgent' : ''}">ğŸ“… ${p.deadline} (${deadlineText})</span>
                <span>ğŸ·ï¸ ${p.category}</span>
              </div>
              <div class="progress-bar"><div class="fill" style="width:${p.progress}%"></div></div>
              <div class="progress-text">ì§„í–‰ë¥  ${p.progress}%</div>
              ${p.note ? `<div class="note">${p.note}</div>` : ''}
              ${p.link ? `<a href="${p.link}" target="_blank" class="link-btn">ê³µê³  ë°”ë¡œê°€ê¸°</a>` : ''}
            </div>
          `;
        }).join("");
      }

      document.getElementById("last-updated").textContent = new Date().toLocaleString("ko-KR");
    }

    function setStatus(status) { state.selectedStatus = status; render(); }

    document.getElementById("filter-category").addEventListener("change", e => { state.selectedCategory = e.target.value; render(); });
    document.getElementById("filter-search").addEventListener("input", e => { state.searchQuery = e.target.value; render(); });

    // ===================== INIT =====================
    render();
  </script>
</body>
</html>